<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Keep the same CSS styles from previous version -->
    <style>
        /* ... (same CSS styles as before) ... */
    </style>
</head>
<body>
    <!-- Keep the same HTML structure -->
    <div id="game-container">
        <!-- ... (same HTML as before) ... -->
    </div>

    <script>
        const BOARD_SIZE = 8;
        const KNIGHT_MOVES = [
            [-2, -1], [-2, 1], [-1, -2], [-1, 2],
            [1, -2], [1, 2], [2, -1], [2, 1]
        ];

        let gameState = {
            level: 1,
            moves: 0,
            time: 0,
            knightPos: [0, 0],
            goalPos: [7, 7],
            obstacles: new Set(),
            timer: null,
            isPlaying: false
        };

        function init() {
            createBoard();
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('board').addEventListener('click', handleBoardClick);
        }

        function startGame() {
            // Reset level if starting over
            if(gameState.level === 1) {
                gameState.moves = 0;
                gameState.time = 0;
            }
            
            // Clear existing timer
            if(gameState.timer) clearInterval(gameState.timer);
            
            gameState.isPlaying = true;
            document.getElementById('menu-screen').classList.add('hidden');
            setupLevel();
            
            // Update UI
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('moves').textContent = gameState.moves;
            document.getElementById('time').textContent = gameState.time;
            
            // Start new timer
            gameState.timer = setInterval(() => {
                gameState.time++;
                document.getElementById('time').textContent = gameState.time;
            }, 1000);
        }

        function setupLevel() {
            // Reset knight position and clear obstacles
            gameState.knightPos = [0, 0];
            gameState.obstacles.clear();
            
            // Generate new obstacles for current level
            while(gameState.obstacles.size < 5 + gameState.level * 2) {
                const x = Math.floor(Math.random() * BOARD_SIZE);
                const y = Math.floor(Math.random() * BOARD_SIZE);
                if(x !== 0 || y !== 0) gameState.obstacles.add(`${x},${y}`);
            }
            
            updateBoard();
        }

        function completeLevel() {
            clearInterval(gameState.timer);
            gameState.isPlaying = false;
            
            if(gameState.level < 5) {
                setTimeout(() => {
                    alert(`Level ${gameState.level} Complete!`);
                    gameState.level++;
                    startGame(); // Start next level
                }, 100);
            } else {
                alert('Game Complete!');
                gameState.level = 1; // Reset to level 1
                document.getElementById('menu-screen').classList.remove('hidden');
            }
        }

        // Keep the rest of the functions the same
        function createBoard() { /* ... */ }
        function handleBoardClick(e) { /* ... */ }
        function isValidMove(target) { /* ... */ }
        function moveKnight(target) { /* ... */ }
        function updateBoard() { /* ... */ }

        window.addEventListener('load', init);
    </script>
</body>
</html>